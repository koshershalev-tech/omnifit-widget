<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />

<title>OMNIFIT V13 ‚Äî Fixed Height + Internal Scroll</title>

<style>
/* ===========================================================
   GLOBAL RESET
=========================================================== */
* { margin: 0; padding: 0; box-sizing: border-box; }
body {
  font-family: -apple-system, BlinkMacSystemFont, "SF Pro Display", sans-serif;
  background: transparent;
}

/* ===========================================================
   WIDGET WRAPPER ‚Äî FIXED HEIGHT + SCROLL (V13)
=========================================================== */
#omnifitWidget {
  width: 100%;
  max-width: 315px;
  height: 500px;              /* ‚≠ê Fixed height */
  margin: 0 auto;
  overflow-y: auto;           /* ‚≠ê Internal scroll */
  scroll-behavior: smooth;
  position: relative;
  padding-bottom: 40px;
}

/* ===========================================================
   NEBULA BACKGROUND (CLIPPED TO WIDGET)
=========================================================== */
.nebula {
  position: absolute;
  inset: 0;
  z-index: -1;
  background:
    radial-gradient(at 20% 30%, rgba(155,255,210,0.22), rgba(0,0,0,0) 62%),
    radial-gradient(at 80% 65%, rgba(255,180,120,0.18), rgba(0,0,0,0) 70%),
    radial-gradient(at 50% 90%, rgba(120,180,255,0.16), rgba(0,0,0,0) 75%);
  animation: nebulaGlow 14s ease-in-out infinite alternate;
}
@keyframes nebulaGlow {
  0%   { filter: brightness(1.1); }
  100% { filter: brightness(1.25); }
}

/* ===========================================================
   TILES ‚Äî COMPRESSED (V13)
=========================================================== */
.tiles {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 10px;
  margin-top: 16px;
  padding: 0 10px;
}
.tile {
  padding: 12px 10px;
  border-radius: 14px;
  background: rgba(255,255,255,0.75);
  backdrop-filter: blur(14px);
  font-size: 0.95rem;
  font-weight: 500;
  position: relative;
  overflow: hidden;
  color: #1d1d1d;
  transition: transform 0.2s ease;
}
.tile:hover { transform: scale(1.03); }

/* Active colors */
.tile.active[data-motive="Educational"] { background:#E6F0D8; color:#245C2A; }
.tile.active[data-motive="Playful"]    { background:#FFF2D5; color:#A96300; }
.tile.active[data-motive="Direct"]     { background:#E3F2FD; color:#0F4C9A; }
.tile.active[data-motive="Identity"]   { background:#FCE8E0; color:#9A3D21; }

/* ===========================================================
   FLOATING CARD ‚Äî COMPRESSED VERSION (V13)
=========================================================== */
.card {
  position: relative;
  margin: 0 auto;
  top: 15px;                     /* ‚≠ê Much higher */
  width: 90%;
  background: rgba(230,240,216,0.28);
  backdrop-filter: blur(22px);
  padding: 20px 18px;
  border-radius: 16px;
  color: white;
  box-shadow: 0 4px 14px rgba(0,0,0,0.18);
  transform: scale(.96);
  transition: transform .3s ease;
}

.card h1 { font-size: 1.1rem; margin-bottom: 4px; }
.card h2 { font-size: 0.9rem; opacity: 0.9; }
.card .motive-tag { margin-top: 8px; font-size: 1rem; }

/* ===========================================================
   HEATMAP ‚Äî COMPRESSED (V13)
=========================================================== */
.heatmapSection {
  margin-top: 140px;     /* ‚≠ê Significantly closer */
  padding: 0 14px 30px;
  color: white;
}
.heatmapSection h2 {
  font-size: 1rem;
  margin-bottom: 10px;
  opacity: 0.85;
}

.heatmapRow {
  display: flex;
  align-items: center;
  gap: 6px;
  margin-bottom: 10px;
}

.rowLabel {
  width: 30px;
  font-size: 0.8rem;
  opacity: 0.7;
}

.square {
  width: 18px;
  height: 18px;
  border-radius: 4px;
  background: #E6F0D8;
  cursor: pointer;
  transition: transform .2s ease;
}
.square:hover { transform: scale(1.15); }

/* Heat levels */
.level-0 { background:#E6F0D8; opacity:0.45; }
.level-1 { background:#C9E2B5; opacity:0.60; }
.level-2 { background:#A8CC8C; opacity:0.78; }
.level-3 { background:#8BB076; opacity:1; }

/* ===========================================================
   BOTTOM SHEET ‚Äî UNCHANGED
=========================================================== */
#motivePanel {
  position: fixed;
  left: 0;
  bottom: -100%;
  width: 100%;
  height: 70%;
  background: rgba(255,255,255,0.25);
  backdrop-filter: blur(28px);
  border-radius: 24px 24px 0 0;
  padding: 26px;
  color: white;
  transition: bottom .45s ease;
  z-index: 50;
}
#motivePanel.open { bottom: 0; }

#closePanel {
  position: absolute;
  top: 12px;
  right: 18px;
  font-size: 32px;
  opacity: 0.7;
  cursor: pointer;
}

/* ===========================================================
   V11: Ripple + Press + Glow + Float
=========================================================== */
.ripple-container { position:absolute; inset:0; pointer-events:none; overflow:hidden; }
.ripple {
  position:absolute;
  width:20px; height:20px;
  background:rgba(255,255,255,0.35);
  border-radius:50%;
  transform:scale(0);
  animation:rippleExpand .5s ease-out forwards;
}
@keyframes rippleExpand {
  to { transform:scale(8); opacity:0; }
}
.press { transform:scale(.95); }

.glow-pulse { animation: glowPulse .55s ease-out; }
@keyframes glowPulse {
  0% { box-shadow:0 0 0 rgba(139,176,118,0); }
 40% { box-shadow:0 0 12px rgba(139,176,118,1); }
100% { box-shadow:0 0 0 rgba(139,176,118,0); }
}

.streak-float {
  position:absolute;
  color:white;
  font-size:.8rem;
  animation:floatUp .6s ease-out forwards;
}
@keyframes floatUp {
  0% { opacity:0; transform:translateY(0); }
 30% { opacity:1; }
100% { opacity:0; transform:translateY(-14px); }
}
</style>
</head>

<body>
<div id="omnifitWidget">
  <div class="nebula"></div>
  <div id="dimOverlay"></div>

  <!-- ============================= -->
  <!-- TILES                         -->
  <!-- ============================= -->
  <div class="tiles" id="tiles">
    <div class="tile" data-motive="Educational">Educational</div>
    <div class="tile" data-motive="Playful">Playful</div>
    <div class="tile" data-motive="Direct">Direct</div>
    <div class="tile" data-motive="Identity">Identity</div>
  </div>

  <!-- ============================= -->
  <!-- CARD                          -->
  <!-- ============================= -->
  <div class="card" id="exerciseCard">
    <svg id="cardIcon" viewBox="0 0 24 24" stroke="white" fill="none" stroke-width="1.7"></svg>
    <h1>Micro Exercise</h1>
    <h2>Day 558 | Forge üî•</h2>
    <div class="motive-tag" id="motiveLabel">Educational</div>
  </div>

  <!-- ============================= -->
  <!-- HEATMAP                       -->
  <!-- ============================= -->
  <div class="heatmapSection">
    <h2>Your Consistency</h2>

    <div class="heatmapRow"><div class="rowLabel">SUN</div><div id="row-sun"></div></div>
    <div class="heatmapRow"><div class="rowLabel">TUE</div><div id="row-tue"></div></div>
    <div class="heatmapRow"><div class="rowLabel">FRI</div><div id="row-fri"></div></div>
    <div class="heatmapRow"><div class="rowLabel">SAT</div><div id="row-sat"></div></div>
  </div>

  <!-- ============================= -->
  <!-- BOTTOM SHEET                  -->
  <!-- ============================= -->
  <div id="motivePanel">
    <div id="closePanel">√ó</div>
    <div id="panelContent"></div>
    <div id="toggleCompleteBtn"></div>
  </div>

</div> <!-- END WIDGET WRAPPER -->

<script>
/* ===========================================================
   ICONS + DESCRIPTIONS
=========================================================== */
const icons = {
  Educational:`<path d="M12 3v18"/><path d="M8 7h8"/><path d="M10 12h4"/>`,
  Playful:`<path d="M12 4l1 3 3 1-3 1-1 3-1-3-3-1 3-1z"/>`,
  Direct:`<path d="M5 12h14"/><path d="M13 8l6 4-6 4"/>`,
  Identity:`<circle cx="12" cy="12" r="6"/><circle cx="12" cy="12" r="2.2"/>`
};

const descriptions = {
  Educational:"Clear reasoning and helpful science explaining why this matters.",
  Playful:"A spark of lightness to keep the work feeling less heavy.",
  Direct:"Straight guidance ‚Äî do this, feel better.",
  Identity:"A reminder of who you're becoming through consistent action."
};

/* ===========================================================
   TILE INTERACTION
=========================================================== */
const tiles = document.querySelectorAll('.tile');
const card = document.getElementById('exerciseCard');
const motiveLabel = document.getElementById('motiveLabel');
const cardIcon = document.getElementById('cardIcon');
const panel = document.getElementById('motivePanel');
const panelContent = document.getElementById('panelContent');
const dimOverlay = document.getElementById('dimOverlay');
const toggleBtn = document.getElementById('toggleCompleteBtn');

tiles.forEach(tile => {
  tile.addEventListener('click', () => {
    const m = tile.dataset.motive;
    motiveLabel.textContent = m;
    cardIcon.innerHTML = icons[m];

    tiles.forEach(t => t.classList.remove('active'));
    tile.classList.add('active');

    panelContent.innerHTML = `
      <svg viewBox="0 0 24 24" stroke="white" fill="none" stroke-width="1.7">${icons[m]}</svg>
      <h3>${m}</h3>
      <p>${descriptions[m]}</p>
    `;

    toggleBtn.style.display = "none";

    panel.classList.add("open");
    dimOverlay.style.opacity = "1";
    dimOverlay.style.pointerEvents = "auto";
  });
});

document.getElementById('closePanel').onclick = closePanel;
dimOverlay.onclick = closePanel;

function closePanel() {
  panel.classList.remove("open");
  dimOverlay.style.opacity = "0";
  dimOverlay.style.pointerEvents = "none";
}

/* ===========================================================
   HEATMAP ENGINE
=========================================================== */
const heatmapData = {
  sun: [0,1,2,3,1,0,2,3,0,1,2,3],
  tue: [0,0,1,2,3,1,1,2,0,0,2,3],
  fri: [3,3,2,1,0,1,2,3,2,2,1,0],
  sat: [1,2,1,0,0,3,3,2,2,1,1,0]
};

function createHeatmap() {
  for (const d in heatmapData) {
    const row = document.getElementById(`row-${d}`);
    heatmapData[d].forEach((lvl,i)=>{
      const sq=document.createElement("div");
      sq.className=`square level-${lvl}`;
      sq.onclick=()=>openDayPanel(d,i);
      row.appendChild(sq);
    });
  }
}
createHeatmap();

/* ===========================================================
   PANEL: OPEN DAY
=========================================================== */
let currentDayKey=null;
let currentIndex=null;

function openDayPanel(day,index){
  currentDayKey=day;
  currentIndex=index;

  let lvl=heatmapData[day][index];

  panelContent.innerHTML=`
    <h3>${day.toUpperCase()} ‚Äî Day ${index+1}</h3>
    <p>Level: ${lvl}/3</p>
  `;

  toggleBtn.style.display="block";
  toggleBtn.textContent=lvl===0?"Mark Complete":"Mark Incomplete";

  toggleBtn.onclick=toggleIntensity;

  panel.classList.add("open");
  dimOverlay.style.opacity="1";
  dimOverlay.style.pointerEvents="auto";
}

/* ===========================================================
   ORIGINAL TOGGLE
=========================================================== */
function originalToggleIntensity(){
  let current = heatmapData[currentDayKey][currentIndex];
  let next = current===0?3:0;
  heatmapData[currentDayKey][currentIndex]=next;

  // update UI
  const row=document.getElementById(`row-${currentDayKey}`);
  row.children[currentIndex].className=`square level-${next}`;

  openDayPanel(currentDayKey,currentIndex);
}

/* ===========================================================
   STREAK ENGINE
=========================================================== */
const cycleOrder=["sat","fri","tue","sun"];
function calculateStreak(){
  let flat=[];
  const len=heatmapData.sun.length;

  for(let i=len-1;i>=0;i--){
    for(const d of cycleOrder){
      flat.push(heatmapData[d][i]);
    }
  }
  let s=0;
  for(const val of flat){
    if(val===3) s++;
    else break;
  }
  return s;
}

/* ===========================================================
   V11: INTERACTIONS
=========================================================== */
function attachRipples(){
  document.querySelectorAll('.tile, .square').forEach(el=>{
    const rc=document.createElement('div');
    rc.classList.add('ripple-container');
    el.appendChild(rc);

    el.addEventListener('pointerdown',e=>{
      el.classList.add('press');
      createRipple(e,rc);
    });
    el.addEventListener('pointerup',()=>el.classList.remove('press'));
    el.addEventListener('pointerleave',()=>el.classList.remove('press'));
  });
}
attachRipples();

function createRipple(e,container){
  const r=document.createElement('div');
  r.className='ripple';
  const rect=container.getBoundingClientRect();
  r.style.left=(e.clientX-rect.left-10)+"px";
  r.style.top=(e.clientY-rect.top-10)+"px";
  container.appendChild(r);
  setTimeout(()=>r.remove(),600);
}

function glowPulseSquare(day,index){
  const sq=document.getElementById(`row-${day}`).children[index];
  sq.classList.add("glow-pulse");
  setTimeout(()=>sq.classList.remove("glow-pulse"),600);
}

function showStreakFloat(day,index){
  const sq=document.getElementById(`row-${day}`).children[index];
  const rect=sq.getBoundingClientRect();
  const f=document.createElement("div");
  f.className="streak-float";
  f.textContent="+1 Streak";
  f.style.left=rect.left+"px";
  f.style.top=rect.top+"px";
  document.body.appendChild(f);
  setTimeout(()=>f.remove(),700);
}

/* Apply streak float + glow */
toggleIntensity=function(){
  const before=calculateStreak();
  originalToggleIntensity();
  const after=calculateStreak();
  if(after>before){
    glowPulseSquare(currentDayKey,currentIndex);
    showStreakFloat(currentDayKey,currentIndex);
  }
};
</script>

</body>
</html>


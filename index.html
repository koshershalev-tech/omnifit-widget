<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>OMNIFIT Widget V3</title>

<style>
:root{
  --sage-light:#E6F0D8;
  --sage-mid:#BFD4A5;
  --sage-dark:#8BB076;
  --border:#DCE7FF;
  --ink:#111;
  --muted:#475569;
  --card:#FFFFFF;
  --frame-bg:#E8E6E6;
}

/* page base */
html,body{
  margin:0; padding:0;
  background:var(--frame-bg);
  font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Arial;
}
body{
  display:flex;
  justify-content:center;
  padding:12px;
  overflow-x:hidden;
}

/* wrapper */
#wrap{
  width:640px; max-width:640px;
  background:var(--card);
  border-radius:16px;
  border:1.5px solid var(--border);
  box-shadow:0 8px 24px rgba(0,0,0,0.05);
  padding:20px;
  box-sizing:border-box;
}

/* header */
#headerTitle{
  text-align:center;
  font-weight:700;
  font-size:20px;
  color:var(--ink);
  margin-bottom:12px;
}

/* NAV BUTTONS */
.header-nav{
  display:flex;
  justify-content:center;
  gap:28px;
  margin-bottom:8px;
}
.nav-btn{
  width:32px; height:32px;
  border-radius:8px;
  border:1.5px solid var(--border);
  background:white;
  font-size:18px;
  cursor:pointer;
  transition:.2s;
}
.nav-btn:disabled{
  opacity:.4; cursor:not-allowed;
}

/* HEATMAP */
#heatmapContainer{
  margin:0 auto 20px auto;
  width:fit-content;
}

/* Month Labels */
.hm-months{
  display:flex;
  font-size:12px;
  color:#666;
  margin-left:40px;
  margin-bottom:6px;
}
.hm-month{
  min-width:50px;
  text-align:left;
}

/* row labels */
.hm-rows{
  display:flex;
  flex-direction:column;
  justify-content:space-between;
  margin-right:6px;
  font-size:12px;
  color:#666;
  font-weight:500;
}

/* grid */
.hm-wrapper{
  display:flex;
}
.hm-grid{
  display:grid;
  grid-auto-flow:column;
  grid-template-rows:repeat(4, 1fr);
  gap:3px;
}
.hm-cell{
  width:14px; height:14px;
  background:#F2F2F2;
  border-radius:3px;
}

/* TAB BAR */
#tabs{
  display:flex;
  justify-content:space-between;
  margin-bottom:14px;
}
.tab{
  flex:1;
  text-align:center;
  padding:6px 8px;
  margin:0 4px;
  border-radius:999px;
  border:1.5px solid var(--border);
  background:#fff;
  color:var(--muted);
  font-weight:600;
  cursor:pointer;
  transition:all .2s;
}
.tab.active{
  background:var(--sage-light);
  color:var(--ink);
  border-color:var(--sage-light);
}

/* CARD */
#contentCard{
  background:white;
  border-radius:14px;
  border:1.5px solid #E0E6E2;
  box-shadow:0 8px 24px rgba(0,0,0,0.05);
  padding:16px;
  max-height:58vh;
  overflow-y:auto;
  position:relative;
}

.checkmark{
  position:absolute;
  bottom:14px; right:14px;
  width:24px; height:24px;
  border-radius:6px;
  border:2px solid var(--border);
  display:flex;
  align-items:center; justify-content:center;
  cursor:pointer;
  background:#fff;
}
.checkmark.checked{
  background:var(--sage-light);
  border-color:var(--sage-dark);
}
.checkmark.checked::after{
  content:"✓";
  color:var(--sage-dark);
  font-weight:700;
}

</style>
</head>
<body>
<div id="wrap">

  <!-- NAV -->
  <div class="header-nav">
    <button id="prevBtn" class="nav-btn">←</button>
    <button id="nextBtn" class="nav-btn">→</button>
  </div>

  <!-- HEADER -->
  <div id="headerTitle">Loading…</div>

  <!-- HEATMAP -->
  <div id="heatmapContainer">
    <div id="heatmapMonths" class="hm-months"></div>

    <div class="hm-wrapper">
      <div class="hm-rows">
        <div>Sun</div><div>Tue</div><div>Fri</div><div>Sat</div>
      </div>
      <div id="heatmap" class="hm-grid"></div>
    </div>
  </div>

  <!-- TABS -->
  <div id="tabs">
    <div class="tab active" data-tab="micro">Micro Exercise</div>
    <div class="tab" data-tab="daily">Omnifit Daily</div>
    <div class="tab" data-tab="motivation">Motivation</div>
  </div>

  <!-- CONTENT -->
  <div id="contentCard"></div>

</div>

<script>
const JSON_URL = "./omnifit_data.json";
let DAYS = [];
let index = 0;
let activeTab = "micro";

const KEY_MICRO = date => `omni_micro_${date}`;
const KEY_MOTIV = date => `omni_motiv_${date}`;

fetch(JSON_URL)
  .then(r=>r.json())
  .then(data=>{
    DAYS = data;
    index = DAYS.length - 1; // latest day
    buildHeatmap();
    render();
  });

/* HEADER */
function renderHeader(){
  const d = DAYS[index];
  const dayNum = calcDayNumber(d.date);
  document.getElementById("headerTitle").textContent =
    `Day ${dayNum} | ${d.day_type}`;
}
function calcDayNumber(dateStr){
  const epoch = new Date("2024-05-13");
  return Math.floor((new Date(dateStr)-epoch)/86400000)+1;
}

/* CONTENT */
function buildContent(){
  const d = DAYS[index];
  if(activeTab==="micro")
    return contentBlock("Micro Daily Exercise", d.micro, isMicroDone(d.date), ()=>toggleMicro(d.date));

  if(activeTab==="daily")
    return contentBlock("Omnifit Daily", d.daily, false);

  if(activeTab==="motivation")
    return contentBlock("Motivation", makeLinks(d.motivation), isMotivDone(d.date), ()=>toggleMotiv(d.date));
}

function contentBlock(title, text, showCheck, toggleFn){
  return `
    <h3>${title}</h3>
    <div>${formatText(text)}</div>
    ${showCheck ? `<div class="checkmark ${isMicroDone ? 'checked':''}" onclick="(${toggleFn})()"></div>` : ""}
  `;
}

function formatText(t){
  if(!t) return "";
  return makeLinks(t.replace(/\n/g,"<br>"));
}

/* MAKE LINKS CLICKABLE */
function makeLinks(text){
  return text.replace(
    /(https?:\/\/[^\s<]+)/g,
    '<br><a href="$1" target="_blank" style="color:#2a6;">$1</a>'
  );
}

/* LOCAL STORAGE */
function isMicroDone(date){ return localStorage.getItem(KEY_MICRO(date))==="1"; }
function isMotivDone(date){ return localStorage.getItem(KEY_MOTIV(date))==="1"; }

function toggleMicro(date){
  localStorage.setItem(KEY_MICRO(date), isMicroDone(date)?"0":"1");
  updateHeatmap(); render();
}
function toggleMotiv(date){
  localStorage.setItem(KEY_MOTIV(date), isMotivDone(date)?"0":"1");
  updateHeatmap(); render();
}

/* HEATMAP */
function buildHeatmap(){
  const total = 84; // 12 weeks = 3 months
  const recent = DAYS.slice(-total);

  const hm = document.getElementById("heatmap");
  const months = document.getElementById("heatmapMonths");

  hm.innerHTML = "";
  months.innerHTML = "";

  // month labels every ~4 weeks
  const uniqueMonths = [...new Set(recent.map(d=>d.date.slice(0,7)))];
  uniqueMonths.forEach(m=>{
    months.innerHTML += `<div class="hm-month">${monthName(m.slice(5,7))}</div>`;
  });

  recent.forEach(d=>{
    const cell = document.createElement("div");
    cell.className = "hm-cell";

    const score =
      (isMicroDone(d.date)?1:0) + (isMotivDone(d.date)?1:0);

    if(score===1) cell.style.background="var(--sage-light)";
    if(score===2) cell.style.background="var(--sage-mid)";

    hm.appendChild(cell);
  });
}

function updateHeatmap(){ buildHeatmap(); }

function monthName(n){
  return ["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"][parseInt(n)-1];
}

/* NAV */
document.getElementById("prevBtn").onclick = ()=>{ if(index>0){ index--; render(); }};
document.getElementById("nextBtn").onclick = ()=>{ if(index<DAYS.length-1){ index++; render(); }};

document.querySelectorAll(".tab").forEach(tab=>{
  tab.onclick = ()=>{
    activeTab = tab.dataset.tab;
    document.querySelectorAll(".tab").forEach(t=>t.classList.remove("active"));
    tab.classList.add("active");
    render();
  };
});

function render(){
  renderHeader();
  document.getElementById("contentCard").innerHTML = buildContent();
}

</script>
</body>
</html>





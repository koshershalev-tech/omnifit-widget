<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>OMNIFIT 5-System Widget</title>
<style>
:root{
  --sage:#E6F0D8; --terra:#D95C4C; --ink:#0F172A; --line:#7aa3ff22; --card:#fff; --blue:#78A8FF;
}
html,body{margin:0;height:100%;font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Arial}
body{background:var(--sage);display:flex;align-items:center;justify-content:center;padding:8px}
.widget{width:min(560px,100%);background:var(--card);border:2px solid #5A8AF3;border-radius:14px;
  box-shadow:0 6px 20px rgba(16,24,40,.08);padding:18px}
.date-wrap{display:flex;align-items:center;justify-content:center;gap:14px;margin-bottom:14px}
.icon-btn{width:44px;height:44px;border-radius:10px;border:1.5px solid #1112;display:grid;place-items:center;background:#fff;cursor:pointer}
.icon-btn:disabled{opacity:.4;cursor:not-allowed}
.bigdate{font-weight:800;font-size:56px;letter-spacing:2px;color:#9FC1FF}
.tabs{display:flex;gap:12px;justify-content:center;margin:8px 0 16px}
.tab{padding:10px 18px;border-radius:10px;border:2px solid #111;cursor:pointer;background:#000;color:#fff;font-weight:800;letter-spacing:.3px}
.tab.active{background:#5A8AF3;border-color:#2E5FF0}
.subhead{display:flex;align-items:center;gap:10px;color:#9FC1FF;font-size:24px;margin:6px 0 8px}
.card{background:#fff;border:1.5px solid var(--line);border-radius:12px;padding:18px}
.title{font-size:38px;line-height:1.05;margin:6px 0 8px;color:#000;font-weight:900}
.label{color:#475569;font-size:18px;margin:6px 0}
.content{font-size:22px;color:#111}
.foot{display:flex;justify-content:space-between;align-items:center;margin-top:14px}
.badge{font-size:12px;background:#F8FAFF;border:1px solid #DCE7FF;color:#2E5FF0;padding:6px 10px;border-radius:999px}
@media(max-width:420px){.bigdate{font-size:40px}.tab{padding:8px 12px}.title{font-size:28px}.content{font-size:18px}}
</style>
</head>
<body>
<div class="widget" id="omnifit">
  <div class="date-wrap">
    <button id="prev" class="icon-btn" title="Previous day">&#8592;</button>
    <div class="bigdate" id="bigDate">000000</div>
    <button id="next" class="icon-btn" title="Next day">&#8594;</button>
  </div>
  <div class="tabs" role="tablist">
    <button class="tab active" data-tab="physical">PHYSICAL</button>
    <button class="tab" data-tab="neurological">NEUROLOGICAL</button>
    <button class="tab" data-tab="cognitive">COGNITIVE</button>
    <button class="tab" data-tab="emotional">EMOTIONAL</button>
    <button class="tab" data-tab="lifestyle">LIFESTYLE</button>
  </div>
  <div class="subhead"><span id="weekday">DAY</span><span id="dateTiny">000000</span></div>
  <div class="card">
    <div class="title" id="title">OMNIFIT DAILY</div>
    <div class="label">Today:</div>
    <div class="content" id="content">Loading…</div>
    <div class="foot"><span class="badge" id="badge">Physical</span><span id="status"></span></div>
  </div>
</div>


<script>
const SHEET_CSV_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vT3nLs1K-6nUX1RTtSH1lBQpp0HtQQLr-i-cS2Qzy904M3UVUMlO1HAvk9ijGYtWE691qt1hJrxgc9a/pub?output=csv";


const state = { days: [], idx: 0, system: "physical" };
const $ = s => document.querySelector(s);
const $$ = s => document.querySelectorAll(s);


function toISO(d){const y=d.getFullYear(),m=String(d.getMonth()+1).padStart(2,'0'),dd=String(d.getDate()).padStart(2,'0');return `${y}-${m}-${dd}`;}
function toCompact(iso){return iso.replaceAll('-','');}
function weekdayName(iso){return new Date(iso+'T00:00:00').toLocaleDateString(undefined,{weekday:'long'}).toUpperCase();}
function titleFor(sys){return {physical:'Move',neurological:'Control',cognitive:'Focus',emotional:'Regulate',lifestyle:'Integrate'}[sys];}
function cap(s){return s.charAt(0).toUpperCase()+s.slice(1);}


function csvToDays(text){
  const rows = text.trim().split(/\r?\n/).map(r=>r.split(/,(?=(?:[^"]*"[^"]*")*[^"]*$)/).map(c=>c.replace(/^"|"$/g,'')));
  const hdr = rows.shift().map(h=>h.trim().toLowerCase());
  const idx = Object.fromEntries(hdr.map((h,i)=>[h,i]));
  return rows.map(r=>({
    date: r[idx.date],
    physical: r[idx.physical],
    neurological: r[idx.neurological],
    cognitive: r[idx.cognitive],
    emotional: r[idx.emotional],
    lifestyle: r[idx.lifestyle],
  })).sort((a,b)=>a.date.localeCompare(b.date));
}


function findTodayIndex(days){
  const today = toISO(new Date());
  const i = days.findIndex(d=>d.date===today);
  return i>=0? i : 0;
}


function render(){
  const d = state.days[state.idx]; if(!d) return;
  $("#bigDate").textContent = toCompact(d.date);
  $("#weekday").textContent = weekdayName(d.date);
  $("#dateTiny").textContent = toCompact(d.date);
  $("#title").textContent = titleFor(state.system) + " — OMNIFIT";
  $("#content").textContent = d[state.system] || "No entry.";
  $("#badge").textContent = cap(state.system);
  $("#prev").disabled = state.idx<=0;
  $("#next").disabled = state.idx>=state.days.length-1;
}


function bind(){
  $$("#omnifit .tab").forEach(b=>{
    b.addEventListener("click", ()=>{
      $$("#omnifit .tab").forEach(x=>x.classList.remove("active"));
      b.classList.add("active");
      state.system = b.dataset.tab;
      render();
    });
  });
  $("#prev").addEventListener("click", ()=>{ if(state.idx>0){state.idx--; render();}});
  $("#next").addEventListener("click", ()=>{ if(state.idx<state.days.length-1){state.idx++; render();}});
}


async function load(){
  try{
    const res = await fetch(SHEET_CSV_URL,{cache:"no-store"});
    const text = await res.text();
    state.days = csvToDays(text);
    state.idx = findTodayIndex(state.days);
    $("#status").textContent = "Live";
  }catch(e){
    $("#status").textContent = "Data load error";
  }
  render();
}


bind(); load();
</script>
</body>
</html>